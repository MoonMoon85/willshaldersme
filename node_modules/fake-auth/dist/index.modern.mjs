function n(){return(n=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n}).apply(this,arguments)}var e={onChangeCallback:null,signin:function(n,e){var t=this;return a(n).then(function(n){if(n){if(n.user.password===e)return t.changeAuthToken(n.token),n.user;throw new l("auth/wrong-password","Password is wrong")}throw new l("auth/user-not-found","Email does not have an account")})},signup:function(n,e){var t=this;return a(n).then(function(o){if(o)throw new l("auth/email-already-in-use","Email is already in use");var r={token:String(Math.floor(1e4*Math.random())),user:{email:n,password:e}};return u(r).then(function(){return t.changeAuthToken(r.token),r.user})})},signout:function(){try{return this.changeAuthToken(null),Promise.resolve()}catch(n){return Promise.reject(n)}},onChange:function(n){var e=this;this.onChangeCallback=n;var t=function(n){r(n).then(function(n){e.onChangeCallback(!!n&&n.user)})},o=window.addEventListener("storage",function(n){"auth-token"===n.key&&t(JSON.parse(n.newValue))},!1),a=s("auth-token");return t(a),function(){window.removeEventListener("storage",o)}},sendPasswordResetEmail:function(n){return a(n).then(function(n){throw n?(c("auth-pass-reset-code",n.token),console.log("Your one-time use password reset code:",n.token),new l("auth/cannot-send-email","You're using Fake Auth, which cannot send password reset emails. These emails normally contain a link to your site with a special reset code. But worry not! Fake Auth has stored the reset code locally in your browser so you can simply go to your change password page now and choose a new password. This enables you to fully test your password reset flow and error states without involving emails.")):new l("auth/user-not-found","Email does not have an account")})},confirmPasswordReset:function(n,e){var t;return e?t=e:(t=s("auth-pass-reset-code"),window.localStorage.removeItem("auth-pass-reset-code")),i(t,{password:n}).then(function(n){if(n)return!0;throw new l("auth/invalid-action-code","Invalid password update code")})},changeAuthToken:function(n){var e=this;c("auth-token",n),this.onChangeCallback&&r(n).then(function(n){e.onChangeCallback(!!n&&n.user)})}},t=function(){return s("auth-db",[])},o=function(n){return c("auth-db",n)},r=function(n){return h(function(){return t().find(function(e){return e.token===n})})},a=function(n){return h(function(){return t().find(function(e){return e.user.email===n})})},u=function(n){return h(function(){var e=t();e.push(n),o(e)})},i=function(e,r){return void 0===r&&(r={}),h(function(){var a=t(),u=a.findIndex(function(n){return n.token===e});return-1!==u&&(a[u].user=n({},a[u].user,{},r),o(a),!0)})};function s(n,e){void 0===e&&(e=null);var t=window.localStorage.getItem(n);return t?JSON.parse(t):e}function c(n,e){window.localStorage.setItem(n,JSON.stringify(e))}"undefined"!=typeof window&&0===t().length&&o([{user:{email:"demo@gmail.com",pass:"demo"},token:"12345"}]);var h=function(n){return new Promise(function(e){return setTimeout(function(){e(n())},200)})};function l(n,e){var t=new Error(e);return t.code=n,t}l.prototype=Object.create(Error.prototype);export default e;
//# sourceMappingURL=index.modern.mjs.map
